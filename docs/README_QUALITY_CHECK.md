# æ•°æ®é›†è´¨é‡æ£€æŸ¥ä¸äº¤å‰å»é‡æ–‡æ¡£

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•å¯¹è®­ç»ƒé›†å’ŒéªŒè¯é›†è¿›è¡Œè´¨é‡æ£€æŸ¥å’Œäº¤å‰å»é‡ã€‚

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [è´¨é‡æ£€æŸ¥å·¥å…·](#è´¨é‡æ£€æŸ¥å·¥å…·)
3. [æ£€æŸ¥æµç¨‹](#æ£€æŸ¥æµç¨‹)
4. [æ£€æŸ¥ç»“æœ](#æ£€æŸ¥ç»“æœ)
5. [é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
6. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)

---

## æ¦‚è¿°

### ç›®æ ‡
ç¡®ä¿è®­ç»ƒé›†å’ŒéªŒè¯é›†ä¹‹é—´æ²¡æœ‰é‡å¤æ•°æ®ï¼Œä¿è¯æ•°æ®æ ¼å¼ä¸€è‡´ï¼Œç”Ÿæˆè¯¦ç»†çš„è´¨é‡æ£€æµ‹æŠ¥å‘Šã€‚

### æ•°æ®é›†ä¿¡æ¯
- **è®­ç»ƒé›†**: `train_data/dataset/girlfriend_chat_dataset_20251117_055552.json`
  - æ ·æœ¬æ•°: 2,000 æ¡
  - å”¯ä¸€åœºæ™¯: 71 ä¸ª
  - æ ¼å¼æœ‰æ•ˆç‡: 100%

- **éªŒè¯é›†**: `train_data/validation/girlfriend_chat_validation_20251123_074751.json`
  - æ ·æœ¬æ•°: 400 æ¡
  - å”¯ä¸€åœºæ™¯: 70 ä¸ª
  - æ ¼å¼æœ‰æ•ˆç‡: 100%

---

## è´¨é‡æ£€æŸ¥å·¥å…·

### cross_dedup_check.py

ä¸€ä¸ªç»¼åˆæ€§çš„äº¤å‰å»é‡å’Œè´¨é‡æ£€æŸ¥å·¥å…·ã€‚

**ä¸»è¦åŠŸèƒ½**:
- âœ… åŠ è½½å’Œè§£æè®­ç»ƒé›†ä¸éªŒè¯é›†
- âœ… æ£€æµ‹å®Œå…¨ç›¸åŒçš„é‡å¤æ•°æ®
- âœ… ä½¿ç”¨ SequenceMatcher è¿›è¡Œç›¸ä¼¼åº¦æ£€æµ‹ï¼ˆé˜ˆå€¼ 0.90ï¼‰
- âœ… éªŒè¯æ•°æ®æ ¼å¼ä¸€è‡´æ€§ï¼ˆå­—æ®µå®Œæ•´æ€§ã€è¾“å‡ºé•¿åº¦ã€emojiã€è¯­æ°”è¯ï¼‰
- âœ… ç”Ÿæˆè¯¦ç»†çš„å»é‡ç»Ÿè®¡æŠ¥å‘Š
- âœ… æ”¯æŒæŠ¥å‘Šæ¨¡å¼å’Œæ¸…ç†æ¨¡å¼

**æŠ€æœ¯ç‰¹ç‚¹**:
- ç›¸ä¼¼åº¦è®¡ç®—: `difflib.SequenceMatcher`
- é‡å¤åˆ¤å®šç­–ç•¥: 
  - å®Œå…¨ç›¸åŒæ£€æŸ¥ï¼ˆinstruction + input + outputï¼‰
  - ç›¸ä¼¼åº¦æ£€æŸ¥ï¼ˆç›¸åŒ instruction å’Œ inputï¼Œoutput ç›¸ä¼¼åº¦ â‰¥ 0.90ï¼‰

**ç±»ç»“æ„**:
```python
class CrossDeduplicator:
    - load_dataset()           # åŠ è½½æ•°æ®é›†
    - calculate_similarity()   # è®¡ç®—æ–‡æœ¬ç›¸ä¼¼åº¦
    - is_duplicate()           # åˆ¤æ–­æ˜¯å¦é‡å¤
    - find_duplicates()        # æŸ¥æ‰¾æ‰€æœ‰é‡å¤
    - validate_format()        # éªŒè¯æ ¼å¼
    - perform_cross_deduplication()  # æ‰§è¡Œå»é‡
    - save_report()            # ä¿å­˜æŠ¥å‘Š
    - print_report()           # æ‰“å°æŠ¥å‘Š
```

---

## æ£€æŸ¥æµç¨‹

### æ­¥éª¤ 1: å‡†å¤‡å·¥ä½œ

ç¡®ä¿æ•°æ®é›†æ–‡ä»¶å­˜åœ¨:
```bash
ls -lh train_data/dataset/girlfriend_chat_dataset_20251117_055552.json
ls -lh train_data/validation/girlfriend_chat_validation_20251123_074751.json
```

### æ­¥éª¤ 2: è¿è¡Œäº¤å‰å»é‡æ£€æŸ¥

**æŠ¥å‘Šæ¨¡å¼**ï¼ˆæ¨èï¼Œä¸ä¿®æ”¹æ•°æ®ï¼‰:
```bash
python3 cross_dedup_check.py
```

è¯¥å‘½ä»¤ä¼š:
1. åŠ è½½è®­ç»ƒé›†å’ŒéªŒè¯é›†
2. æ£€æµ‹é‡å¤æ•°æ®
3. éªŒè¯æ ¼å¼ä¸€è‡´æ€§
4. ç”Ÿæˆç»Ÿè®¡åˆ†æ
5. ä¿å­˜è¯¦ç»†æŠ¥å‘Š
6. ä¸ä¿®æ”¹ä»»ä½•æ•°æ®æ–‡ä»¶

### æ­¥éª¤ 3: æŸ¥çœ‹æŠ¥å‘Š

**æŸ¥çœ‹ç»ˆç«¯è¾“å‡º**:
è¿è¡Œå‘½ä»¤åä¼šåœ¨ç»ˆç«¯æ˜¾ç¤ºå®Œæ•´çš„æ£€æŸ¥æŠ¥å‘Šã€‚

**æŸ¥çœ‹ JSON è¯¦ç»†æŠ¥å‘Š**:
```bash
cat train_data/cross_dedup_report_YYYYMMDD_HHMMSS.json
```

**æŸ¥çœ‹ Markdown æ€»ç»“æŠ¥å‘Š**:
```bash
cat train_data/CROSS_DEDUP_REPORT.md
```

### æ­¥éª¤ 4: åˆ†æç»“æœ

æ ¹æ®æŠ¥å‘Šä¸­çš„ç»Ÿè®¡æ•°æ®å’Œå»ºè®®ï¼Œå†³å®šä¸‹ä¸€æ­¥æªæ–½ã€‚

---

## æ£€æŸ¥ç»“æœ

### æ£€æµ‹å‘ç°

#### âš ï¸ é«˜é‡å¤ç‡é—®é¢˜
- **é‡å¤æ•°æ®**: 386 æ¡ï¼ˆå éªŒè¯é›†çš„ 96.5%ï¼‰
- **éé‡å¤æ•°æ®**: 14 æ¡ï¼ˆå éªŒè¯é›†çš„ 3.5%ï¼‰
- **ç›¸ä¼¼åº¦èŒƒå›´**: 90.0% - 97.3%

#### âœ… æ ¼å¼éªŒè¯é€šè¿‡
- **è®­ç»ƒé›†æ ¼å¼**: 100% æœ‰æ•ˆï¼ˆ2000/2000ï¼‰
- **éªŒè¯é›†æ ¼å¼**: 100% æœ‰æ•ˆï¼ˆ400/400ï¼‰
- æ‰€æœ‰æ•°æ®åŒ…å«å¿…éœ€å­—æ®µ: `instruction`, `input`, `output`
- æ‰€æœ‰è¾“å‡ºåŒ…å« emoji å’Œè¯­æ°”è¯

#### ğŸ“Š åœºæ™¯åˆ†æ
- **è®­ç»ƒé›†å”¯ä¸€åœºæ™¯**: 71 ä¸ª
- **éªŒè¯é›†å”¯ä¸€åœºæ™¯**: 70 ä¸ª
- **åœºæ™¯é‡å **: 70 ä¸ªï¼ˆ98.6%ï¼‰

### é‡å¤æ ·æœ¬ç¤ºä¾‹

| éªŒè¯é›†ç´¢å¼• | è®­ç»ƒé›†ç´¢å¼• | ç›¸ä¼¼åº¦ | æŒ‡ä»¤ | è¾“å‡ºç‰‡æ®µ |
|-----------|-----------|--------|------|----------|
| 0 | 191 | 96.30% | æ„Ÿåˆ°æŒ«æŠ˜å¤±æ„ | æ²¡å…³ç³»çš„~ ğŸ˜Š æ¯ä¸ªäººå…¨ä¼šé‡åˆ°æŒ«æŠ˜... |
| 1 | 24 | 95.83% | æé†’å–æ°´ | è¯¥è¡¥å……æ°´åˆ†å•¦ï¼ğŸŒ¸ è¦ä¿æŒæ°´æ¶¦æ¶¦çš„... |
| 2 | 1954 | 94.12% | è§’è‰²æ‰®æ¼”ï¼šè€å¸ˆ | ä¸æ‰“ç´§ï¼ğŸ‘©â€ğŸ« è€å¸ˆæ…¢æ…¢æ•™ä½  ğŸŒ¸ï¼ |
| 4 | 72 | 93.75% | å’Œè§£åœºæ™¯ | å’Œå¥½ï¼ğŸŒ¸ ä»¥åæˆ‘ä»¬è¦å¥½å¥½ç›¸å¤„å“¦ï¼ |
| 5 | 297 | 94.74% | æ„Ÿåˆ°å­¤ç‹¬å¯‚å¯ | ä¸ä¼šå­¤ç‹¬çš„ï¼ğŸ’• å› ä¸ºæœ‰æˆ‘ä¸€ç›´é™ªç€ä½ å‘€ï¼ |

---

## é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜åˆ†æ

**ä¸ºä»€ä¹ˆé‡å¤ç‡å¦‚æ­¤é«˜ï¼ˆ96.5%ï¼‰ï¼Ÿ**

1. **ç›¸åŒçš„ç”Ÿæˆç­–ç•¥**: è®­ç»ƒé›†å’ŒéªŒè¯é›†ä½¿ç”¨äº†ç›¸åŒçš„åœºæ™¯å’Œå“åº”æ¨¡æ¿æ± 
2. **éšæœºç§å­ç›¸ä¼¼**: å¯èƒ½ä½¿ç”¨äº†ç›¸ä¼¼çš„éšæœºç§å­æˆ–ç”Ÿæˆé¡ºåº
3. **æ¨¡æ¿è¦†ç›–ç‡è¿‡é«˜**:
   - æ€»å¯ç”¨å“åº”æ¨¡æ¿: 355 ä¸ª
   - è®­ç»ƒé›†å¤§å°: 2000 æ¡ï¼ˆè¦†ç›–ç‡ 563%ï¼‰
   - å¹³å‡æ¯ä¸ªåœºæ™¯ä½¿ç”¨ 28.2 ä¸ªä¸åŒè¾“å‡º
   - éªŒè¯é›†å¾ˆéš¾æ‰¾åˆ°æœªä½¿ç”¨çš„æ¨¡æ¿ç»„åˆ

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ 1: é‡æ–°ç”ŸæˆéªŒè¯é›†ï¼ˆâ­â­â­â­â­ å¼ºçƒˆæ¨èï¼‰

ä½¿ç”¨ä¸åŒçš„éšæœºç§å­å’Œç”Ÿæˆç­–ç•¥é‡æ–°ç”ŸæˆéªŒè¯é›†:

```bash
# ä½¿ç”¨å®Œå…¨ä¸åŒçš„éšæœºç§å­
python3 generate_girlfriend_dataset.py \
  --num-samples 400 \
  --variants 8 \
  --seed 99999 \
  --output-dir train_data/validation \
  --output-prefix girlfriend_chat_validation_clean

# ç”Ÿæˆåå†æ¬¡æ£€æŸ¥
python3 cross_dedup_check.py
```

**ä¼˜ç‚¹**:
- ä¿è¯è¶³å¤Ÿçš„éªŒè¯é›†è§„æ¨¡ï¼ˆ400+ æ¡ï¼‰
- ä¿æŒæ•°æ®è´¨é‡å’Œæ ¼å¼ä¸€è‡´æ€§
- ç¡®ä¿è®­ç»ƒå’ŒéªŒè¯çš„æœ‰æ•ˆåˆ†ç¦»

**æ³¨æ„äº‹é¡¹**:
- ä½¿ç”¨ä¸è®­ç»ƒé›†å®Œå…¨ä¸åŒçš„éšæœºç§å­
- ç”ŸæˆååŠ¡å¿…å†æ¬¡è¿è¡Œäº¤å‰å»é‡æ£€æŸ¥
- å¦‚æœä»æœ‰é‡å¤ï¼Œè€ƒè™‘ä½¿ç”¨æ›´é«˜çš„å˜ä½“æ•°é‡

#### æ–¹æ¡ˆ 2: ä½¿ç”¨å˜ä½“å¼•æ“ç”Ÿæˆå·®å¼‚åŒ–æ ·æœ¬ï¼ˆâ­â­â­â­ï¼‰

åˆ©ç”¨ `variation_engine.py` åˆ›å»ºæ–°çš„å˜ä½“:

```python
from variation_engine import VariationEngine
from scenarios import SCENARIO_CATALOG

# åˆå§‹åŒ–å˜ä½“å¼•æ“ï¼ˆä½¿ç”¨ä¸åŒçš„ç§å­ï¼‰
engine = VariationEngine(seed=88888)

# ä¸ºæ¯ä¸ªåœºæ™¯ç”Ÿæˆæ–°å˜ä½“
for scenario in SCENARIO_CATALOG:
    for template in scenario.response_templates:
        variants = engine.generate_variants(
            template, 
            num_variants=5,
            emotion_tone="care"
        )
        # æ£€æŸ¥å˜ä½“æ˜¯å¦ä¸è®­ç»ƒé›†é‡å¤
        # ä¿å­˜éé‡å¤å˜ä½“
```

**ä¼˜ç‚¹**:
- åˆ©ç”¨å˜ä½“å¼•æ“çš„å¤šæ ·æ€§ç­–ç•¥
- å¯ä»¥ç”Ÿæˆé£æ ¼ç›¸ä¼¼ä½†æªè¾ä¸åŒçš„æ ·æœ¬
- æ›´ç²¾ç»†çš„æ§åˆ¶

#### æ–¹æ¡ˆ 3: æ¸…ç†é‡å¤æ•°æ®ï¼ˆâ­ ä¸æ¨èï¼‰

ç›´æ¥åˆ é™¤é‡å¤æ•°æ®:

```python
# ä¿®æ”¹ cross_dedup_check.py
report = deduplicator.perform_cross_deduplication(
    train_path=train_path,
    val_path=val_path,
    report_only=False  # æ”¹ä¸º False
)
```

**ç¼ºç‚¹**:
- éªŒè¯é›†ä»…å‰© 14 æ¡æ ·æœ¬
- æ ·æœ¬æ•°é‡ä¸¥é‡ä¸è¶³
- æ— æ³•è¿›è¡Œæœ‰æ•ˆçš„æ¨¡å‹éªŒè¯

---

## ä½¿ç”¨æŒ‡å—

### åŸºæœ¬ä½¿ç”¨

#### 1. æ£€æŸ¥å½“å‰æ•°æ®é›†ï¼ˆæŠ¥å‘Šæ¨¡å¼ï¼‰

```bash
python3 cross_dedup_check.py
```

è¾“å‡º:
- ç»ˆç«¯æ˜¾ç¤ºå®Œæ•´æŠ¥å‘Š
- ç”Ÿæˆ JSON è¯¦ç»†æŠ¥å‘Š: `train_data/cross_dedup_report_YYYYMMDD_HHMMSS.json`

#### 2. æ¸…ç†é‡å¤æ•°æ®ï¼ˆæ¸…ç†æ¨¡å¼ï¼‰

ä¿®æ”¹ `cross_dedup_check.py` ç¬¬ 408 è¡Œ:

```python
report = deduplicator.perform_cross_deduplication(
    train_path=train_path,
    val_path=val_path,
    report_only=False  # æ”¹ä¸º False ä»¥æ‰§è¡Œæ¸…ç†
)
```

ç„¶åè¿è¡Œ:
```bash
python3 cross_dedup_check.py
```

âš ï¸ **è­¦å‘Š**: æ¸…ç†æ¨¡å¼ä¼šç›´æ¥ä¿®æ”¹éªŒè¯é›†æ–‡ä»¶ï¼Œè¯·å…ˆå¤‡ä»½ï¼

### é«˜çº§é…ç½®

#### è°ƒæ•´ç›¸ä¼¼åº¦é˜ˆå€¼

åœ¨ `cross_dedup_check.py` ä¸­ä¿®æ”¹:

```python
# æ›´ä¸¥æ ¼çš„é˜ˆå€¼ï¼ˆæ£€æµ‹æ›´å¤šé‡å¤ï¼‰
deduplicator = CrossDeduplicator(similarity_threshold=0.85)

# æ›´å®½æ¾çš„é˜ˆå€¼ï¼ˆæ£€æµ‹æ›´å°‘é‡å¤ï¼‰
deduplicator = CrossDeduplicator(similarity_threshold=0.95)
```

#### æŒ‡å®šä¸åŒçš„æ•°æ®é›†è·¯å¾„

ä¿®æ”¹ `cross_dedup_check.py` ä¸­çš„é…ç½®:

```python
train_path = "path/to/your/training_dataset.json"
val_path = "path/to/your/validation_dataset.json"
```

#### è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„

```python
report = deduplicator.perform_cross_deduplication(
    train_path=train_path,
    val_path=val_path,
    output_path="path/to/cleaned_validation.json",
    report_only=False
)
```

### æ‰¹é‡å¤„ç†

å¦‚æœæœ‰å¤šä¸ªæ•°æ®é›†éœ€è¦æ£€æŸ¥:

```python
# create batch_check.py
from cross_dedup_check import CrossDeduplicator

datasets = [
    ("dataset1_train.json", "dataset1_val.json"),
    ("dataset2_train.json", "dataset2_val.json"),
]

deduplicator = CrossDeduplicator(similarity_threshold=0.90)

for train_path, val_path in datasets:
    print(f"\nChecking {train_path} vs {val_path}...")
    report = deduplicator.perform_cross_deduplication(
        train_path, val_path, report_only=True
    )
    deduplicator.save_report(report)
```

---

## è¾“å‡ºæ–‡ä»¶

### ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶

1. **JSON è¯¦ç»†æŠ¥å‘Š**: `train_data/cross_dedup_report_20251123_082117.json`
   - å®Œæ•´çš„æ£€æµ‹æ•°æ®
   - é‡å¤æ ·æœ¬è¯¦æƒ…ï¼ˆå‰20ä¸ªï¼‰
   - æ ¼å¼éªŒè¯ç»“æœ
   - åœºæ™¯åˆ†æç»Ÿè®¡

2. **Markdown æ€»ç»“æŠ¥å‘Š**: `train_data/CROSS_DEDUP_REPORT.md`
   - äººç±»å¯è¯»çš„æ ¼å¼
   - æ‰§è¡Œæ‘˜è¦
   - é‡å¤æ ·æœ¬ç¤ºä¾‹
   - å»ºè®®æªæ–½

3. **å·¥å…·è„šæœ¬**: `cross_dedup_check.py`
   - å¯é‡å¤ä½¿ç”¨çš„æ£€æŸ¥å·¥å…·
   - æ”¯æŒä¸åŒé…ç½®
   - é€‚ç”¨äºå¤šä¸ªæ•°æ®é›†

### æ•°æ®é›†å¤‡ä»½

- **åŸå§‹éªŒè¯é›†å¤‡ä»½**: `train_data/validation/girlfriend_chat_validation_20251123_074751.json.backup`

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆåœºæ™¯é‡å ç‡è¿™ä¹ˆé«˜ï¼ˆ98.6%ï¼‰ï¼Ÿ

**A**: è¿™æ˜¯æ­£å¸¸ä¸”é¢„æœŸçš„è¡Œä¸ºã€‚éªŒè¯é›†åº”è¯¥è¦†ç›–ä¸è®­ç»ƒé›†ç›¸åŒçš„åœºæ™¯ç±»åˆ«ï¼Œä»¥è¯„ä¼°æ¨¡å‹åœ¨å„ç§åœºæ™¯ä¸‹çš„æ³›åŒ–èƒ½åŠ›ã€‚é‡å çš„æ˜¯åœºæ™¯ï¼ˆinstructionï¼‰ï¼Œè€Œä¸åº”è¯¥é‡å çš„æ˜¯å…·ä½“çš„è¾“å‡ºï¼ˆoutputï¼‰ã€‚

### Q2: ç›¸ä¼¼åº¦é˜ˆå€¼ 0.90 æ˜¯å¦‚ä½•é€‰æ‹©çš„ï¼Ÿ

**A**: 0.90 æ˜¯ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼š
- å¤ªä½ï¼ˆå¦‚ 0.80ï¼‰ï¼šå¯èƒ½æ¼æ‰ä¸€äº›é«˜åº¦ç›¸ä¼¼çš„æ ·æœ¬
- å¤ªé«˜ï¼ˆå¦‚ 0.95ï¼‰ï¼šå¯èƒ½ä¿ç•™è¿‡å¤šå®è´¨ç›¸åŒçš„æ ·æœ¬
- 0.90ï¼šèƒ½å¤Ÿæ£€æµ‹å‡ºå¤§éƒ¨åˆ†ç›¸ä¼¼æ ·æœ¬ï¼ŒåŒæ—¶ä¿ç•™ä¸€äº›åˆç†çš„å˜ä½“

### Q3: æ£€æµ‹åˆ°é‡å¤ååº”è¯¥æ€ä¹ˆåŠï¼Ÿ

**A**: ä¼˜å…ˆè€ƒè™‘é‡æ–°ç”ŸæˆéªŒè¯é›†ï¼ˆæ–¹æ¡ˆ1ï¼‰ï¼Œå› ä¸ºï¼š
- ä¿è¯è¶³å¤Ÿçš„éªŒè¯æ•°æ®é‡
- ä¿æŒæ•°æ®è´¨é‡
- é¿å…ä¿¡æ¯æ³„æ¼

### Q4: å¦‚ä½•ç¡®ä¿æ–°ç”Ÿæˆçš„éªŒè¯é›†ä¸é‡å¤ï¼Ÿ

**A**: ç”Ÿæˆæ–°éªŒè¯é›†åï¼ŒåŠ¡å¿…å†æ¬¡è¿è¡Œ `cross_dedup_check.py` è¿›è¡ŒéªŒè¯ã€‚é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°é‡å¤ç‡é™ä½åˆ°å¯æ¥å—çš„æ°´å¹³ï¼ˆå»ºè®® < 5%ï¼‰ã€‚

### Q5: æ ¼å¼éªŒè¯éƒ½æ£€æŸ¥ä»€ä¹ˆï¼Ÿ

**A**: æ ¼å¼éªŒè¯åŒ…æ‹¬ï¼š
- å¿…éœ€å­—æ®µ: `instruction`, `input`, `output`
- è¾“å‡ºé•¿åº¦: 5-300 å­—ç¬¦ï¼ˆå»ºè®® 15-200ï¼‰
- Emoji è¦†ç›–: æ£€æµ‹å¸¸ç”¨ emoji Unicode èŒƒå›´
- è¯­æ°”è¯: æ£€æµ‹ä¸­æ–‡è¯­æ°”åŠ©è¯ï¼ˆå‘€ã€å•¦ã€å‘¢ç­‰ï¼‰

---

## æŠ€æœ¯ç»†èŠ‚

### ç›¸ä¼¼åº¦è®¡ç®—

ä½¿ç”¨ Python çš„ `difflib.SequenceMatcher`:

```python
from difflib import SequenceMatcher

def calculate_similarity(text1: str, text2: str) -> float:
    return SequenceMatcher(None, text1, text2).ratio()
```

### é‡å¤åˆ¤å®šé€»è¾‘

```python
def is_duplicate(entry1, entry2):
    # 1. å®Œå…¨ç›¸åŒæ£€æŸ¥
    if (entry1['instruction'] == entry2['instruction'] and 
        entry1['input'] == entry2['input'] and 
        entry1['output'] == entry2['output']):
        return True
    
    # 2. ç›¸ä¼¼åº¦æ£€æŸ¥ï¼ˆåŒåœºæ™¯åŒè¾“å…¥ï¼Œè¾“å‡ºé«˜åº¦ç›¸ä¼¼ï¼‰
    if (entry1['instruction'] == entry2['instruction'] and 
        entry1['input'] == entry2['input']):
        similarity = calculate_similarity(entry1['output'], entry2['output'])
        if similarity >= 0.90:
            return True
    
    return False
```

### æ€§èƒ½è€ƒè™‘

å¯¹äºå¤§å‹æ•°æ®é›†ï¼ˆ> 10000 æ¡ï¼‰ï¼Œè€ƒè™‘ä¼˜åŒ–:
- ä½¿ç”¨å“ˆå¸Œè¡¨å¿«é€ŸæŸ¥æ‰¾å®Œå…¨ç›¸åŒçš„æ ·æœ¬
- å¯¹ç›¸åŒ instruction+input çš„æ ·æœ¬åˆ†ç»„åå†æ¯”è¾ƒ
- å¹¶è¡Œå¤„ç†å¤šä¸ªæ¯”è¾ƒä»»åŠ¡

---

## æ›´æ–°æ—¥å¿—

### 2025-11-23
- âœ… å®ç° `cross_dedup_check.py` å·¥å…·
- âœ… å®Œæˆè®­ç»ƒé›†å’ŒéªŒè¯é›†äº¤å‰å»é‡æ£€æŸ¥
- âœ… ç”Ÿæˆè¯¦ç»†çš„ JSON å’Œ Markdown æŠ¥å‘Š
- âœ… å‘ç° 96.5% çš„é‡å¤ç‡é—®é¢˜
- âœ… æä¾›ä¸‰ç§è§£å†³æ–¹æ¡ˆå’Œä½¿ç”¨æŒ‡å—
- âœ… åˆ›å»ºæœ¬æ–‡æ¡£

---

## ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®æ€»è§ˆ
- [README_DATASET.md](README_DATASET.md) - æ•°æ®é›†æ–‡æ¡£
- [README_VARIATION_ENGINE.md](README_VARIATION_ENGINE.md) - å˜ä½“å¼•æ“æ–‡æ¡£
- [CROSS_DEDUP_REPORT.md](train_data/CROSS_DEDUP_REPORT.md) - äº¤å‰å»é‡æŠ¥å‘Š

---

**æ–‡æ¡£ç»´æŠ¤è€…**: AI Dataset Team  
**æœ€åæ›´æ–°**: 2025-11-23  
**ç‰ˆæœ¬**: 1.0
